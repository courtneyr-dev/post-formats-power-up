(()=>{"use strict";const t=window.React,e=window.wp.plugins,n=window.wp.components,r=window.wp.data,a=window.wp.element,o=window.wp.i18n,s=window.wp.a11y,i=window.wp.hooks,p=window.wp.blocks,c=window.wp.compose,m={},l=(t,e,n=null,r=!1)=>{if(m[t])return!1;if(!window.pfbtData?.patterns?.[t])return!1;const a=window.pfbtData.patterns[t],o=(0,p.parse)(a);return o.length>0&&(r&&n?n(o):e(o,0,void 0,!1),m[t]=!0,!0)},d=()=>{const t=(0,a.useRef)(null),{currentFormat:e,postType:n,blocks:i}=(0,r.useSelect)(t=>{const e=t("core/editor"),n=t("core/block-editor");return{currentFormat:e.getEditedPostAttribute("format")||"standard",postType:e.getCurrentPostType(),blocks:n.getBlocks()}},[]),{insertBlocks:p,resetBlocks:c}=(0,r.useDispatch)("core/block-editor");return(0,a.useEffect)(()=>{if("post"!==n)return;if(t.current===e)return;const r=null===t.current;if(t.current=e,r)return;if("standard"===e)return;const a=0===i.length||1===i.length&&"core/paragraph"===i[0].name&&!i[0].attributes.content;if(window.pfbtData?.patterns?.[e]&&l(e,p,c,a)){const t=window.pfbtData.formats?.[e]?.name||e;(0,s.speak)(sprintf((0,o.__)("Switched to %s format. Pattern inserted.","post-formats-for-block-themes"),t),"polite")}},[e,n,i,p,c]),null},u=()=>{const[e,i]=(0,a.useState)(!1),[p,c]=(0,a.useState)(!1),{isNewPost:m,currentFormat:d,postType:u}=(0,r.useSelect)(t=>{const e=t("core/editor"),n=e.getCurrentPost();return{isNewPost:!n.id||"auto-draft"===n.status,currentFormat:e.getEditedPostAttribute("format")||"standard",postType:n.type}},[]),{editPost:f}=(0,r.useDispatch)("core/editor"),{insertBlocks:w,resetBlocks:g}=(0,r.useDispatch)("core/block-editor");if((0,a.useEffect)(()=>{m&&"post"===u&&!p&&window.pfbtData&&setTimeout(()=>{i(!0),c(!0)},500)},[m,u,p]),!e||!window.pfbtData)return null;const h=window.pfbtData.formats,b=Object.entries(h).map(([t,e])=>"standard"===t?[t,{...e,name:(0,o.__)("Standard (Single Template)","post-formats-for-block-themes"),description:(0,o.__)("Default post format using the Single template","post-formats-for-block-themes")}]:[t,e]).sort((t,e)=>"standard"===t[0]?-1:"standard"===e[0]?1:t[1].name.localeCompare(e[1].name));return(0,t.createElement)(n.Modal,{title:(0,o.__)("Choose Post Format","post-formats-for-block-themes"),onRequestClose:()=>i(!1),className:"pfpu-format-modal"},(0,t.createElement)("div",{className:"pfpu-format-grid"},b.map(([e,r])=>(0,t.createElement)(n.Card,{key:e,className:"pfpu-format-card"},(0,t.createElement)(n.CardBody,null,(0,t.createElement)(n.Button,{onClick:()=>(t=>{if(f({format:t}),"standard"!==t&&window.pfbtData?.formats?.[t]){const e=window.pfbtData.formats[t];l(t,w,g,!0),(0,s.speak)(sprintf(/* translators: %s: Format name */ /* translators: %s: Format name */
(0,o.__)("Selected %s format. Pattern inserted.","post-formats-for-block-themes"),e.name),"polite")}i(!1)})(e),className:"pfpu-format-button",variant:"standard"===e?"primary":"secondary"},(0,t.createElement)("span",{className:`dashicons dashicons-${r.icon}`,"aria-hidden":"true"}),(0,t.createElement)("span",{className:"pfpu-format-name"},r.name)),(0,t.createElement)("p",{className:"pfpu-format-description"},r.description))))))};(0,e.registerPlugin)("post-formats-for-block-themes",{render:()=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)(u,null),(0,t.createElement)(d,null))});const f=(0,c.createHigherOrderComponent)(e=>n=>{const{name:a,attributes:s}=n,i=((0,r.useSelect)(t=>{const e=t("core/editor");return e?e.getEditedPostAttribute("format"):null},[]),s.className?.includes("status-paragraph"));if("core/paragraph"!==a||!i)return(0,t.createElement)(e,{...n});const p=280-(s.content||"").replace(/<[^>]*>/g,"").length,c=p<0;return(0,t.createElement)("div",{className:"pfpu-status-paragraph-wrapper"},(0,t.createElement)(e,{...n}),(0,t.createElement)("div",{className:`pfpu-char-counter ${c?"is-over-limit":""} ${p<=20?"is-warning":""}`,"aria-live":"polite","aria-atomic":"true"},(0,t.createElement)("span",null,sprintf(/* translators: %d: Remaining characters */ /* translators: %d: Remaining characters */
(0,o.__)("%d characters remaining","post-formats-for-block-themes"),p))))},"withStatusCharacterCounter");if((0,i.addFilter)("editor.BlockEdit","pfpu/status-paragraph-counter",f),"undefined"!=typeof document){const t=document.createElement("style");t.textContent="\n\t.pfpu-format-modal {\n\t\tmax-width: 800px;\n\t}\n\n\t.pfpu-format-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n\t\tgap: 1rem;\n\t\tmargin-top: 1rem;\n\t}\n\n\t.pfpu-format-card {\n\t\ttext-align: center;\n\t}\n\n\t.pfpu-format-button {\n\t\twidth: 100%;\n\t\theight: auto;\n\t\tpadding: 1rem;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tgap: 0.5rem;\n\t}\n\n\t.pfpu-format-button .dashicons {\n\t\tfont-size: 2rem;\n\t\twidth: 2rem;\n\t\theight: 2rem;\n\t}\n\n\t.pfpu-format-name {\n\t\tfont-weight: 600;\n\t}\n\n\t.pfpu-format-description {\n\t\tfont-size: 0.875rem;\n\t\tcolor: #757575;\n\t\tmargin-top: 0.5rem;\n\t}\n\n\t.pfpu-format-change-actions {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 0.5rem;\n\t\tmargin-top: 1rem;\n\t}\n\n\t.pfpu-status-validator {\n\t\tmargin-top: 1rem;\n\t}\n\n\t.pfpu-status-paragraph-wrapper {\n\t\tposition: relative;\n\t\tmargin-bottom: 30px;\n\t}\n\n\t.pfpu-char-counter {\n\t\tposition: absolute;\n\t\tbottom: -25px;\n\t\tright: 0;\n\t\tfont-size: 0.875rem;\n\t\tcolor: #757575;\n\t\tbackground: #fff;\n\t\tpadding: 2px 8px;\n\t\tborder-radius: 3px;\n\t\tbox-shadow: 0 1px 3px rgba(0,0,0,0.1);\n\t}\n\n\t.pfpu-char-counter.is-warning {\n\t\tcolor: #f0b849;\n\t\tfont-weight: 600;\n\t}\n\n\t.pfpu-char-counter.is-over-limit {\n\t\tcolor: #d63638;\n\t\tfont-weight: 600;\n\t\tbackground: #fcf0f1;\n\t}\n",document.head.appendChild(t)}})();